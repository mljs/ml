// ml@v0.0.2, MIT licensed. https://github.com/mljs/ml
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.ML=t()}}(function(){var define,module,exports;return function t(r,o,i){function n(s,a){if(!o[s]){if(!r[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(e)return e(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var u=o[s]={exports:{}};r[s][0].call(u.exports,function(t){var o=r[s][1][t];return n(o?o:t)},u,u.exports,t,r,o,i)}return o[s].exports}for(var e="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,r,o){o.Matrix=t("ml-matrix");var i={};i.SOM=t("ml-som"),o.nn=i},{"ml-matrix":3,"ml-som":5}],2:[function(t,r){"use strict";function o(t){if(t=g.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");var r,o,a=t.columns,f=g.zeros(a,a),u=new Array(a),c=new Array(a),m=t;if(t.isSymmetric()){for(r=0;a>r;r++)for(o=0;a>o;o++)f[r][o]=m[r][o];i(a,c,u,f),n(a,c,u,f)}else{var l=g.zeros(a,a),p=new Array(a);for(o=0;a>o;o++)for(r=0;a>r;r++)l[r][o]=m[r][o];e(a,l,p,f),s(a,c,u,f,l)}return new h(a,c,u,f)}function i(t,r,o,i){var n,e,s,a,h,f,u,c;for(h=0;t>h;h++)o[h]=i[t-1][h];for(a=t-1;a>0;a--){for(c=0,s=0,f=0;a>f;f++)c+=Math.abs(o[f]);if(0===c)for(r[a]=o[a-1],h=0;a>h;h++)o[h]=i[a-1][h],i[a][h]=0,i[h][a]=0;else{for(f=0;a>f;f++)o[f]/=c,s+=o[f]*o[f];for(n=o[a-1],e=Math.sqrt(s),n>0&&(e=-e),r[a]=c*e,s-=n*e,o[a-1]=n-e,h=0;a>h;h++)r[h]=0;for(h=0;a>h;h++){for(n=o[h],i[h][a]=n,e=r[h]+i[h][h]*n,f=h+1;a-1>=f;f++)e+=i[f][h]*o[f],r[f]+=i[f][h]*n;r[h]=e}for(n=0,h=0;a>h;h++)r[h]/=s,n+=r[h]*o[h];for(u=n/(s+s),h=0;a>h;h++)r[h]-=u*o[h];for(h=0;a>h;h++){for(n=o[h],e=r[h],f=h;a-1>=f;f++)i[f][h]-=n*r[f]+e*o[f];o[h]=i[a-1][h],i[a][h]=0}}o[a]=s}for(a=0;t-1>a;a++){if(i[t-1][a]=i[a][a],i[a][a]=1,s=o[a+1],0!==s){for(f=0;a>=f;f++)o[f]=i[f][a+1]/s;for(h=0;a>=h;h++){for(e=0,f=0;a>=f;f++)e+=i[f][a+1]*i[f][h];for(f=0;a>=f;f++)i[f][h]-=e*o[f]}}for(f=0;a>=f;f++)i[f][a+1]=0}for(h=0;t>h;h++)o[h]=i[t-1][h],i[t-1][h]=0;i[t-1][t-1]=1,r[0]=0}function n(t,r,o,i){var n,e,s,a,h,f,u,c,m,l,p,d,w,v,M,g,x;for(s=1;t>s;s++)r[s-1]=r[s];r[t-1]=0;var b=0,R=0,k=Math.pow(2,-52);for(f=0;t>f;f++){for(R=Math.max(R,Math.abs(o[f])+Math.abs(r[f])),u=f;t>u&&!(Math.abs(r[u])<=k*R);)u++;if(u>f){x=0;do{for(x+=1,n=o[f],c=(o[f+1]-n)/(2*r[f]),m=y(c,1),0>c&&(m=-m),o[f]=r[f]/(c+m),o[f+1]=r[f]*(c+m),l=o[f+1],e=n-o[f],s=f+2;t>s;s++)o[s]-=e;for(b+=e,c=o[u],p=1,d=p,w=p,v=r[f+1],M=0,g=0,s=u-1;s>=f;s--)for(w=d,d=p,g=M,n=p*r[s],e=p*c,m=y(c,r[s]),r[s+1]=M*m,M=r[s]/m,p=c/m,c=p*o[s]-M*n,o[s+1]=e+M*(p*n+M*o[s]),h=0;t>h;h++)e=i[h][s+1],i[h][s+1]=M*i[h][s]+p*e,i[h][s]=p*i[h][s]-M*e;c=-M*g*w*v*r[f]/l,r[f]=M*c,o[f]=p*c}while(Math.abs(r[f])>k*R)}o[f]=o[f]+b,r[f]=0}for(s=0;t-1>s;s++){for(h=s,c=o[s],a=s+1;t>a;a++)o[a]<c&&(h=a,c=o[a]);if(h!==s)for(o[h]=o[s],o[s]=c,a=0;t>a;a++)c=i[a][s],i[a][s]=i[a][h],i[a][h]=c}}function e(t,r,o,i){var n,e,s,a,h,f,u,c=0,m=t-1;for(f=c+1;m-1>=f;f++){for(u=0,a=f;m>=a;a++)u+=Math.abs(r[a][f-1]);if(0!==u){for(s=0,a=m;a>=f;a--)o[a]=r[a][f-1]/u,s+=o[a]*o[a];for(e=Math.sqrt(s),o[f]>0&&(e=-e),s-=o[f]*e,o[f]=o[f]-e,h=f;t>h;h++){for(n=0,a=m;a>=f;a--)n+=o[a]*r[a][h];for(n/=s,a=f;m>=a;a++)r[a][h]-=n*o[a]}for(a=0;m>=a;a++){for(n=0,h=m;h>=f;h--)n+=o[h]*r[a][h];for(n/=s,h=f;m>=h;h++)r[a][h]-=n*o[h]}o[f]=u*o[f],r[f][f-1]=u*e}}for(a=0;t>a;a++)for(h=0;t>h;h++)i[a][h]=a===h?1:0;for(f=m-1;f>=c+1;f--)if(0!==r[f][f-1]){for(a=f+1;m>=a;a++)o[a]=r[a][f-1];for(h=f;m>=h;h++){for(e=0,a=f;m>=a;a++)e+=o[a]*i[a][h];for(e=e/o[f]/r[f][f-1],a=f;m>=a;a++)i[a][h]+=e*o[a]}}}function s(t,r,o,i,n){var e,s,h,f,u,c,m,l,p,d,w,y,v,M,g,x=t-1,b=0,R=t-1,k=Math.pow(2,-52),S=0,A=0,j=0,O=0,C=0,D=0,I=0,V=0;for(e=0;t>e;e++)for((b>e||e>R)&&(o[e]=n[e][e],r[e]=0),s=Math.max(e-1,0);t>s;s++)A+=Math.abs(n[e][s]);for(;x>=b;){for(f=x;f>b&&(D=Math.abs(n[f-1][f-1])+Math.abs(n[f][f]),0===D&&(D=A),!(Math.abs(n[f][f-1])<k*D));)f--;if(f===x)n[x][x]=n[x][x]+S,o[x]=n[x][x],r[x]=0,x--,V=0;else if(f===x-1){if(m=n[x][x-1]*n[x-1][x],j=(n[x-1][x-1]-n[x][x])/2,O=j*j+m,I=Math.sqrt(Math.abs(O)),n[x][x]=n[x][x]+S,n[x-1][x-1]=n[x-1][x-1]+S,l=n[x][x],O>=0){for(I=j>=0?j+I:j-I,o[x-1]=l+I,o[x]=o[x-1],0!==I&&(o[x]=l-m/I),r[x-1]=0,r[x]=0,l=n[x][x-1],D=Math.abs(l)+Math.abs(I),j=l/D,O=I/D,C=Math.sqrt(j*j+O*O),j/=C,O/=C,s=x-1;t>s;s++)I=n[x-1][s],n[x-1][s]=O*I+j*n[x][s],n[x][s]=O*n[x][s]-j*I;for(e=0;x>=e;e++)I=n[e][x-1],n[e][x-1]=O*I+j*n[e][x],n[e][x]=O*n[e][x]-j*I;for(e=b;R>=e;e++)I=i[e][x-1],i[e][x-1]=O*I+j*i[e][x],i[e][x]=O*i[e][x]-j*I}else o[x-1]=l+j,o[x]=l+j,r[x-1]=I,r[x]=-I;x-=2,V=0}else{if(l=n[x][x],p=0,m=0,x>f&&(p=n[x-1][x-1],m=n[x][x-1]*n[x-1][x]),10===V){for(S+=l,e=b;x>=e;e++)n[e][e]-=l;D=Math.abs(n[x][x-1])+Math.abs(n[x-1][x-2]),l=p=.75*D,m=-.4375*D*D}if(30===V&&(D=(p-l)/2,D=D*D+m,D>0)){for(D=Math.sqrt(D),l>p&&(D=-D),D=l-m/((p-l)/2+D),e=b;x>=e;e++)n[e][e]-=D;S+=D,l=p=m=.964}for(V+=1,u=x-2;u>=f&&(I=n[u][u],C=l-I,D=p-I,j=(C*D-m)/n[u+1][u]+n[u][u+1],O=n[u+1][u+1]-I-C-D,C=n[u+2][u+1],D=Math.abs(j)+Math.abs(O)+Math.abs(C),j/=D,O/=D,C/=D,u!==f)&&!(Math.abs(n[u][u-1])*(Math.abs(O)+Math.abs(C))<k*Math.abs(j)*(Math.abs(n[u-1][u-1])+Math.abs(I)+Math.abs(n[u+1][u+1])));)u--;for(e=u+2;x>=e;e++)n[e][e-2]=0,e>u+2&&(n[e][e-3]=0);for(h=u;x-1>=h&&(M=h!==x-1,h!==u&&(j=n[h][h-1],O=n[h+1][h-1],C=M?n[h+2][h-1]:0,l=Math.abs(j)+Math.abs(O)+Math.abs(C),0!==l&&(j/=l,O/=l,C/=l)),0!==l);h++)if(D=Math.sqrt(j*j+O*O+C*C),0>j&&(D=-D),0!==D){for(h!==u?n[h][h-1]=-D*l:f!==u&&(n[h][h-1]=-n[h][h-1]),j+=D,l=j/D,p=O/D,I=C/D,O/=j,C/=j,s=h;t>s;s++)j=n[h][s]+O*n[h+1][s],M&&(j+=C*n[h+2][s],n[h+2][s]=n[h+2][s]-j*I),n[h][s]=n[h][s]-j*l,n[h+1][s]=n[h+1][s]-j*p;for(e=0;e<=Math.min(x,h+3);e++)j=l*n[e][h]+p*n[e][h+1],M&&(j+=I*n[e][h+2],n[e][h+2]=n[e][h+2]-j*C),n[e][h]=n[e][h]-j,n[e][h+1]=n[e][h+1]-j*O;for(e=b;R>=e;e++)j=l*i[e][h]+p*i[e][h+1],M&&(j+=I*i[e][h+2],i[e][h+2]=i[e][h+2]-j*C),i[e][h]=i[e][h]-j,i[e][h+1]=i[e][h+1]-j*O}}}if(0!==A){for(x=t-1;x>=0;x--)if(j=o[x],O=r[x],0===O)for(f=x,n[x][x]=1,e=x-1;e>=0;e--){for(m=n[e][e]-j,C=0,s=f;x>=s;s++)C+=n[e][s]*n[s][x];if(r[e]<0)I=m,D=C;else if(f=e,0===r[e]?n[e][x]=0!==m?-C/m:-C/(k*A):(l=n[e][e+1],p=n[e+1][e],O=(o[e]-j)*(o[e]-j)+r[e]*r[e],c=(l*D-I*C)/O,n[e][x]=c,n[e+1][x]=Math.abs(l)>Math.abs(I)?(-C-m*c)/l:(-D-p*c)/I),c=Math.abs(n[e][x]),k*c*c>1)for(s=e;x>=s;s++)n[s][x]=n[s][x]/c}else if(0>O)for(f=x-1,Math.abs(n[x][x-1])>Math.abs(n[x-1][x])?(n[x-1][x-1]=O/n[x][x-1],n[x-1][x]=-(n[x][x]-j)/n[x][x-1]):(g=a(0,-n[x-1][x],n[x-1][x-1]-j,O),n[x-1][x-1]=g[0],n[x-1][x]=g[1]),n[x][x-1]=0,n[x][x]=1,e=x-2;e>=0;e--){for(d=0,w=0,s=f;x>=s;s++)d+=n[e][s]*n[s][x-1],w+=n[e][s]*n[s][x];if(m=n[e][e]-j,r[e]<0)I=m,C=d,D=w;else if(f=e,0===r[e]?(g=a(-d,-w,m,O),n[e][x-1]=g[0],n[e][x]=g[1]):(l=n[e][e+1],p=n[e+1][e],y=(o[e]-j)*(o[e]-j)+r[e]*r[e]-O*O,v=2*(o[e]-j)*O,0===y&&0===v&&(y=k*A*(Math.abs(m)+Math.abs(O)+Math.abs(l)+Math.abs(p)+Math.abs(I))),g=a(l*C-I*d+O*w,l*D-I*w-O*d,y,v),n[e][x-1]=g[0],n[e][x]=g[1],Math.abs(l)>Math.abs(I)+Math.abs(O)?(n[e+1][x-1]=(-d-m*n[e][x-1]+O*n[e][x])/l,n[e+1][x]=(-w-m*n[e][x]-O*n[e][x-1])/l):(g=a(-C-p*n[e][x-1],-D-p*n[e][x],I,O),n[e+1][x-1]=g[0],n[e+1][x]=g[1])),c=Math.max(Math.abs(n[e][x-1]),Math.abs(n[e][x])),k*c*c>1)for(s=e;x>=s;s++)n[s][x-1]=n[s][x-1]/c,n[s][x]=n[s][x]/c}for(e=0;t>e;e++)if(b>e||e>R)for(s=e;t>s;s++)i[e][s]=n[e][s];for(s=t-1;s>=b;s--)for(e=b;R>=e;e++){for(I=0,h=b;h<=Math.min(s,R);h++)I+=i[e][h]*n[h][s];i[e][s]=I}}}function a(t,r,o,i){var n,e;return Math.abs(o)>Math.abs(i)?(n=i/o,e=o+n*i,[(t+n*r)/e,(r-n*t)/e]):(n=o/i,e=i+n*o,[(n*t+r)/e,(n*r-t)/e])}function h(t,r,o,i){this.n=t,this.e=r,this.d=o,this.V=i}function f(t){t=g.checkMatrix(t);var r,o,i,n,e,s,a,h,f,c,m=t.clone(),l=m.rows,p=m.columns,d=new Array(l),w=1;for(r=0;l>r;r++)d[r]=r;for(f=new Array(l),o=0;p>o;o++){for(r=0;l>r;r++)f[r]=m[r][o];for(r=0;l>r;r++){for(h=m[r],c=Math.min(r,o),e=0,i=0;c>i;i++)e+=h[i]*f[i];h[o]=f[r]-=e}for(n=o,r=o+1;l>r;r++)Math.abs(f[r])>Math.abs(f[n])&&(n=r);if(n!==o){for(i=0;p>i;i++)s=m[n][i],m[n][i]=m[o][i],m[o][i]=s;a=d[n],d[n]=d[o],d[o]=a,w=-w}if(l>o&&0!==m[o][o])for(r=o+1;l>r;r++)m[r][o]/=m[o][o]}return new u(m,d,w)}function u(t,r,o){this.LU=t,this.pivotVector=r,this.pivotSign=o}function c(t){t=g.checkMatrix(t);var r,o,i,n,e=t.clone(),s=t.rows,a=t.columns,h=new Array(a);for(i=0;a>i;i++){var f=0;for(r=i;s>r;r++)f=y(f,e[r][i]);if(0!==f){for(e[i][i]<0&&(f=-f),r=i;s>r;r++)e[r][i]/=f;for(e[i][i]+=1,o=i+1;a>o;o++){for(n=0,r=i;s>r;r++)n+=e[r][i]*e[r][o];for(n=-n/e[i][i],r=i;s>r;r++)e[r][o]+=n*e[r][i]}}h[i]=-f}return new m(e,h)}function m(t,r){this.QR=t,this.Rdiag=r}function l(t,r){t=g.checkMatrix(t),r=r||{};var o=t.clone(),i=t.rows,n=t.columns,e=Math.min(i,n),s=!0,a=!0;r.computeLeftSingularVectors===!1&&(s=!1),r.computeRightSingularVectors===!1&&(a=!1);var h=r.autoTranspose===!0,f=!1;if(n>i)if(h){o=o.transpose(),i=o.rows,n=o.columns,f=!0;var u=s;s=a,a=u}else console.warn("WARNING: Computing SVD on a matrix with more columns than rows.");var c,m,l,d,w,v,M,x,b,R,k,S,A,j,O,C,D,I,V,q,z,E=new Array(Math.min(i+1,n)),U=g.zeros(i,e),_=g.zeros(n,n),L=new Array(n),T=new Array(i),N=Math.min(i-1,n),Q=Math.max(0,Math.min(n-2,i));for(l=0,R=Math.max(N,Q);R>l;l++){if(N>l){for(E[l]=0,c=l;i>c;c++)E[l]=y(E[l],o[c][l]);if(0!==E[l]){for(o[l][l]<0&&(E[l]=-E[l]),c=l;i>c;c++)o[c][l]/=E[l];o[l][l]+=1}E[l]=-E[l]}for(m=l+1;n>m;m++){if(N>l&&0!==E[l]){for(w=0,c=l;i>c;c++)w+=o[c][l]*o[c][m];for(w=-w/o[l][l],c=l;i>c;c++)o[c][m]+=w*o[c][l]}L[m]=o[l][m]}if(s&&N>l)for(c=l;i>c;c++)U[c][l]=o[c][l];if(Q>l){for(L[l]=0,c=l+1;n>c;c++)L[l]=y(L[l],L[c]);if(0!==L[l]){for(L[l+1]<0&&(L[l]=-L[l]),c=l+1;n>c;c++)L[c]/=L[l];L[l+1]+=1}if(L[l]=-L[l],i>l+1&&0!==L[l]){for(c=l+1;i>c;c++)T[c]=0;for(m=l+1;n>m;m++)for(c=l+1;i>c;c++)T[c]+=L[m]*o[c][m];for(m=l+1;n>m;m++)for(w=-L[m]/L[l+1],c=l+1;i>c;c++)o[c][m]+=w*T[c]}if(a)for(c=l+1;n>c;c++)_[c][l]=L[c]}}if(d=Math.min(n,i+1),n>N&&(E[N]=o[N][N]),d>i&&(E[d-1]=0),d>Q+1&&(L[Q]=o[Q][d-1]),L[d-1]=0,s){for(m=N;e>m;m++){for(c=0;i>c;c++)U[c][m]=0;U[m][m]=1}for(l=N-1;l>=0;l--)if(0!==E[l]){for(m=l+1;e>m;m++){for(w=0,c=l;i>c;c++)w+=U[c][l]*U[c][m];for(w=-w/U[l][l],c=l;i>c;c++)U[c][m]+=w*U[c][l]}for(c=l;i>c;c++)U[c][l]=-U[c][l];for(U[l][l]=1+U[l][l],c=0;l-1>c;c++)U[c][l]=0}else{for(c=0;i>c;c++)U[c][l]=0;U[l][l]=1}}if(a)for(l=n-1;l>=0;l--){if(Q>l&&0!==L[l])for(m=l+1;n>m;m++){for(w=0,c=l+1;n>c;c++)w+=_[c][l]*_[c][m];for(w=-w/_[l+1][l],c=l+1;n>c;c++)_[c][m]+=w*_[c][l]}for(c=0;n>c;c++)_[c][l]=0;_[l][l]=1}for(var W=d-1,X=0,P=Math.pow(2,-52);d>0;){for(l=d-2;l>=-1&&-1!==l;l--)if(Math.abs(L[l])<=P*(Math.abs(E[l])+Math.abs(E[l+1]))){L[l]=0;break}if(l===d-2)k=4;else{for(v=d-1;v>=l&&v!==l;v--)if(w=(v!==d?Math.abs(L[v]):0)+(v!==l+1?Math.abs(L[v-1]):0),Math.abs(E[v])<=P*w){E[v]=0;break}v===l?k=3:v===d-1?k=1:(k=2,l=v)}switch(l++,k){case 1:for(M=L[d-2],L[d-2]=0,m=d-2;m>=l;m--)if(w=y(E[m],M),x=E[m]/w,b=M/w,E[m]=w,m!==l&&(M=-b*L[m-1],L[m-1]=x*L[m-1]),a)for(c=0;n>c;c++)w=x*_[c][m]+b*_[c][d-1],_[c][d-1]=-b*_[c][m]+x*_[c][d-1],_[c][m]=w;break;case 2:for(M=L[l-1],L[l-1]=0,m=l;d>m;m++)if(w=y(E[m],M),x=E[m]/w,b=M/w,E[m]=w,M=-b*L[m],L[m]=x*L[m],s)for(c=0;i>c;c++)w=x*U[c][m]+b*U[c][l-1],U[c][l-1]=-b*U[c][m]+x*U[c][l-1],U[c][m]=w;break;case 3:for(S=Math.max(Math.max(Math.max(Math.max(Math.abs(E[d-1]),Math.abs(E[d-2])),Math.abs(L[d-2])),Math.abs(E[l])),Math.abs(L[l])),A=E[d-1]/S,j=E[d-2]/S,O=L[d-2]/S,C=E[l]/S,D=L[l]/S,I=((j+A)*(j-A)+O*O)/2,V=A*O*A*O,q=0,(0!==I||0!==V)&&(q=Math.sqrt(I*I+V),0>I&&(q=-q),q=V/(I+q)),M=(C+A)*(C-A)+q,z=C*D,m=l;d-1>m;m++){if(w=y(M,z),x=M/w,b=z/w,m!==l&&(L[m-1]=w),M=x*E[m]+b*L[m],L[m]=x*L[m]-b*E[m],z=b*E[m+1],E[m+1]=x*E[m+1],a)for(c=0;n>c;c++)w=x*_[c][m]+b*_[c][m+1],_[c][m+1]=-b*_[c][m]+x*_[c][m+1],_[c][m]=w;if(w=y(M,z),x=M/w,b=z/w,E[m]=w,M=x*L[m]+b*E[m+1],E[m+1]=-b*L[m]+x*E[m+1],z=b*L[m+1],L[m+1]=x*L[m+1],s&&i-1>m)for(c=0;i>c;c++)w=x*U[c][m]+b*U[c][m+1],U[c][m+1]=-b*U[c][m]+x*U[c][m+1],U[c][m]=w}L[d-2]=M,X+=1;break;case 4:if(E[l]<=0&&(E[l]=E[l]<0?-E[l]:0,a))for(c=0;W>=c;c++)_[c][l]=-_[c][l];for(;W>l&&!(E[l]>=E[l+1]);){if(w=E[l],E[l]=E[l+1],E[l+1]=w,a&&n-1>l)for(c=0;n>c;c++)w=_[c][l+1],_[c][l+1]=_[c][l],_[c][l]=w;if(s&&i-1>l)for(c=0;i>c;c++)w=U[c][l+1],U[c][l+1]=U[c][l],U[c][l]=w;l++}X=0,d--}}if(f){var B=_;_=U,U=B}return new p(i,n,E,U,_)}function p(t,r,o,i,n){this.m=t,this.n=r,this.s=o,this.U=i,this.V=n}function d(t){if(t=g.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");var r,o,i,n=t,e=n.rows,s=new g(e,e),a=!0;for(o=0;e>o;o++){var h=s[o],f=0;for(i=0;o>i;i++){var u=s[i],c=0;for(r=0;i>r;r++)c+=u[r]*h[r];h[i]=c=(n[o][i]-c)/s[i][i],f+=c*c}for(f=n[o][o]-f,a&=f>0,s[o][o]=Math.sqrt(Math.max(f,0)),i=o+1;e>i;i++)s[o][i]=0}if(!a)throw new Error("Matrix is not positive definite");return new w(s)}function w(t){this.L=t}function y(t,r){var o;return Math.abs(t)>Math.abs(r)?(o=r/t,Math.abs(t)*Math.sqrt(1+o*o)):0!==r?(o=t/r,Math.abs(r)*Math.sqrt(1+o*o)):0}function v(t){return M(t,g.eye(t.rows))}function M(t,r){return t.isSquare()?new f(t).solve(r):new c(t).solve(r)}var g=t("./matrix");h.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return this.V},get diagonalMatrix(){var t,r,o=this.n,i=this.e,n=this.d,e=new g(o,o);for(t=0;o>t;t++){for(r=0;o>r;r++)e[t][r]=0;e[t][t]=n[t],i[t]>0?e[t][t+1]=i[t]:i[t]<0&&(e[t][t-1]=i[t])}return e}},u.prototype={isSingular:function(){for(var t=this.LU,r=t.columns,o=0;r>o;o++)if(0===t[o][o])return!0;return!1},get determinant(){var t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");for(var r=this.pivotSign,o=t.columns,i=0;o>i;i++)r*=t[i][i];return r},get lowerTriangularFactor(){for(var t=this.LU,r=t.rows,o=t.columns,i=new g(r,o),n=0;r>n;n++)for(var e=0;o>e;e++)i[n][e]=n>e?t[n][e]:n===e?1:0;return i},get upperTriangularFactor(){for(var t=this.LU,r=t.rows,o=t.columns,i=new g(r,o),n=0;r>n;n++)for(var e=0;o>e;e++)i[n][e]=e>=n?t[n][e]:0;return i},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(t){t=g.checkMatrix(t);var r=this.LU,o=r.rows;if(o!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var i,n,e,s=t.columns,a=t.subMatrixRow(this.pivotVector,0,s-1),h=r.columns;for(e=0;h>e;e++)for(i=e+1;h>i;i++)for(n=0;s>n;n++)a[i][n]-=a[e][n]*r[i][e];for(e=h-1;e>=0;e--){for(n=0;s>n;n++)a[e][n]/=r[e][e];for(i=0;e>i;i++)for(n=0;s>n;n++)a[i][n]-=a[e][n]*r[i][e]}return a}},m.prototype={solve:function(t){t=g.checkMatrix(t);var r=this.QR,o=r.rows;if(t.rows!==o)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var i,n,e,s,a=t.columns,h=t.clone(),f=r.columns;for(e=0;f>e;e++)for(n=0;a>n;n++){for(s=0,i=e;o>i;i++)s+=r[i][e]*h[i][n];for(s=-s/r[e][e],i=e;o>i;i++)h[i][n]+=s*r[i][e]}for(e=f-1;e>=0;e--){for(n=0;a>n;n++)h[e][n]/=this.Rdiag[e];for(i=0;e>i;i++)for(n=0;a>n;n++)h[i][n]-=h[e][n]*r[i][e]}return h.subMatrix(0,f-1,0,a-1)},isFullRank:function(){for(var t=this.QR.columns,r=0;t>r;r++)if(0===this.Rdiag[r])return!1;return!0},get upperTriangularFactor(){var t,r,o=this.QR,i=o.columns,n=new g(i,i);for(t=0;i>t;t++)for(r=0;i>r;r++)n[t][r]=r>t?o[t][r]:t===r?this.Rdiag[t]:0;return n},get orthogonalFactor(){var t,r,o,i,n=this.QR,e=n.rows,s=n.columns,a=new g(e,s);for(o=s-1;o>=0;o--){for(t=0;e>t;t++)a[t][o]=0;for(a[o][o]=1,r=o;s>r;r++)if(0!==n[o][o]){for(i=0,t=o;e>t;t++)i+=n[t][o]*a[t][r];for(i=-i/n[o][o],t=o;e>t;t++)a[t][r]+=i*n[t][o]}}return a}},p.prototype={get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var t=Math.pow(2,-52),r=Math.max(this.m,this.n)*this.s[0]*t,o=0,i=this.s,n=0,e=i.length;e>n;n++)i[n]>r&&o++;return o},get diagonal(){return this.s},get threshold(){return Math.pow(2,-52)/2*Math.max(this.m,this.n)*this.s[0]},get leftSingularVectors(){return this.U},get rightSingularVectors(){return this.V},get diagonalMatrix(){return g.diag(this.s)},solve:function(t){var r,o=t,i=this.threshold,n=this.s.length,e=g.zeros(n,n);for(r=0;n>r;r++)e[r][r]=Math.abs(this.s[r])<=i?0:1/this.s[r];var s,a,h,f=this.V.mmul(e),u=this.V.rows,c=this.U.rows,m=g.zeros(u,c);for(r=0;u>r;r++)for(s=0;c>s;s++){for(h=0,a=0;n>a;a++)h+=f[r][a]*this.U[s][a];m[r][s]=h}return m.mmul(o)},solveForDiagonal:function(t){return this.solve(g.diag(t))},inverse:function(){var t,r,o=this.threshold,i=this.V.rows,n=this.V.columns,e=new g(i,this.s.length);for(t=0;i>t;t++)for(r=0;n>r;r++)Math.abs(this.s[r])>o&&(e[t][r]=this.V[t][r]/this.s[r]);var s,a,h=this.U.rows,f=this.U.columns,u=new g(i,h);for(t=0;i>t;t++)for(r=0;h>r;r++){for(a=0,s=0;f>s;s++)a+=e[t][s]*this.U[r][s];u[t][r]=a}return u}},w.prototype={get leftTriangularFactor(){return this.L},solve:function(t){t=g.checkMatrix(t);var r=this.L,o=r.rows;if(t.rows!==o)throw new Error("Matrix dimensions do not match");var i,n,e,s=t.columns,a=t.clone();for(e=0;o>e;e++)for(n=0;s>n;n++){for(i=0;e>i;i++)a[e][n]-=a[i][n]*r[e][i];a[e][n]/=r[e][e]}for(e=o-1;e>=0;e--)for(n=0;s>n;n++){for(i=e+1;o>i;i++)a[e][n]-=a[i][n]*r[i][e];a[e][n]/=r[e][e]}return a}},r.exports={LuDecomposition:f,LU:f,QrDecomposition:c,QR:c,SingularValueDecomposition:l,SVD:l,EigenvalueDecomposition:o,EVD:o,CholeskyDecomposition:d,CHO:d,inverse:v,solve:M}},{"./matrix":4}],3:[function(t,r){"use strict";r.exports=t("./matrix"),r.exports.Decompositions=r.exports.DC=t("./decompositions")},{"./decompositions":2,"./matrix":4}],4:[function(t,r){"use strict";function o(t){for(var r=0,o=t.length,i=new Array(o);o>r;r++)i[r]=t[r];return i}function i(t){this.message=t||"Unknown matrix error"}function n(t){throw new i(t)}function e(t,r){var i,s,a=0;if(t instanceof Array)if(s=r,i=s?o(t):t,t=i.length,r=i[0].length,"undefined"==typeof r&&n("Data must be a 2D array"),t>0&&r>0)for(;t>a;a++)i[a].length!==r?n("Inconsistent array dimensions"):s&&(i[a]=o(i[a]));else n("Invalid dimensions: "+t+"x"+r);else if("number"==typeof t)if(t>0&&r>0)for(i=new Array(t);t>a;a++)i[a]=new Array(r);else n("Invalid dimensions: "+t+"x"+r);else n("Invalid arguments");return Object.defineProperty(i,"rows",{writable:!0,value:t}),Object.defineProperty(i,"columns",{writable:!0,value:r}),i.__proto__=e.prototype,i}var s=Array.prototype.splice,a=Array.prototype.concat;i.prototype=Object.create(Error.prototype),i.prototype.name="MatrixError",i.prototype.constructor=i,e.from1DArray=function(t,r,o){var i,s,a=0;for(i=t*r,i!==o.length&&n("Data length does not match given dimensions"),s=new Array(t);t>a;a++)s[a]=o.slice(a*r,(a+1)*r);return new e(s)},e.rowVector=function(t){return new e([t])},e.columnVector=function(t){for(var r=t.length,o=new Array(r),i=0;r>i;i++)o[i]=[t[i]];return new e(o)},e.empty=function(t,r){return new e(t,r)},e.zeros=function(t,r){return e.empty(t,r).fill(0)},e.ones=function(t,r){return e.empty(t,r).fill(1)},e.rand=function(t,r){for(var o=e.empty(t,r),i=0,n=o.rows;n>i;i++)for(var s=0,a=o.columns;a>s;s++)o[i][s]=Math.random();return o},e.eye=function(t){for(var r=e.zeros(t,t),o=r.rows,i=0;o>i;i++)r[i][i]=1;return r},e.diag=function(t){for(var r=t.length,o=e.zeros(r,r),i=0;r>i;i++)o[i][i]=t[i];return o},e.indices=function(t,r){for(var o=new Array(r-t),i=0;i<o.length;i++)o[i]=t++;return o},e.stack=function(t){var r,o,i;if(e.isMatrix(t)){var n=0,s=0;for(r=0;r<arguments.length;r++)n+=arguments[r].rows,arguments[r].columns>s&&(s=arguments[r].columns);var a=e.zeros(n,s),h=0;for(r=0;r<arguments.length;r++){var f=arguments[r];for(o=0;o<f.rows;o++){for(i=0;i<f.columns;i++)a[h][i]=f[o][i];h++}}return a}if(t instanceof Array){var u=e.empty(arguments.length,t.length);for(r=0;r<arguments.length;r++)u.setRow(r,arguments[r]);return u}},e.expand=function(t,r){for(var o=[],i=0;i<r.length;i++)for(var n=0;n<r[i];n++)o.push(t[i]);return new e(o)},e.checkMatrix=function(t){return t||n("Argument has to be a matrix"),"Matrix"!==t.klass&&(t=new e(t)),t},e.isMatrix=function(t){return t?"Matrix"===t.klass:!1},Object.defineProperty(e.prototype,"klass",{get:function(){return"Matrix"}}),Object.defineProperty(e.prototype,"size",{get:function(){return this.rows*this.columns}}),e.prototype.checkRowIndex=function(t){(0>t||t>this.rows-1)&&n("Row index out of range.")},e.prototype.checkColumnIndex=function(t){(0>t||t>this.columns-1)&&n("Column index out of range.")},e.prototype.checkDimensions=function(t){(this.rows!==t.rows||this.columns!==t.columns)&&n("Matrices dimensions must be equal.")},e.prototype.apply=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t.call(this,i,n);return this},e.prototype.clone=function(){return new e(this.to2DArray())},e.prototype.to1DArray=function(){return a.apply([],this)},e.prototype.to2DArray=function(){for(var t=this.rows,r=new Array(t),i=0;t>i;i++)r[i]=o(this[i]);return r},e.prototype.isRowVector=function(){return 1===this.rows},e.prototype.isColumnVector=function(){return 1===this.columns},e.prototype.isVector=function(){return 1===this.rows||1===this.columns},e.prototype.isSquare=function(){return this.rows===this.columns},e.prototype.isSymmetric=function(){if(this.isSquare()){for(var t=this.rows,r=0;t>r;r++)for(var o=0;r>=o;o++)if(this[r][o]!==this[o][r])return!1;return!0}return!1},e.prototype.set=function(t,r,o){return this[t][r]=o,this},e.prototype.get=function(t,r){return this[t][r]},e.prototype.fill=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]=t;return this},e.prototype.neg=function(){return this.mulS(-1)},e.prototype.add=function(t){return"number"==typeof t?this.addS(t):(t=e.checkMatrix(t),this.addM(t))},e.prototype.addS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t;return this},e.prototype.addM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t[i][n];return this},e.prototype.sub=function(t){return"number"==typeof t?this.subS(t):(t=e.checkMatrix(t),this.subM(t))},e.prototype.subS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t;return this},e.prototype.subM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t[i][n];return this},e.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):(t=e.checkMatrix(t),this.mulM(t))},e.prototype.mulS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t;return this},e.prototype.mulM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t[i][n];return this},e.prototype.div=function(t){return"number"==typeof t?this.divS(t):(t=e.checkMatrix(t),this.divM(t))},e.prototype.divS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t;return this},e.prototype.divM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t[i][n];return this},e.prototype.getRow=function(t){return this.checkRowIndex(t),o(this[t])},e.prototype.setRow=function(t,r){return this.checkRowIndex(t),e.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns&&n("Invalid row size"),this[t]=o(r),this},e.prototype.removeRow=function(t){return this.checkRowIndex(t),1===this.rows&&n("A matrix cannot have less than one row"),s.call(this,t,1),this.rows-=1,this},e.prototype.addRow=function(t,r){return"undefined"==typeof r&&(r=t,t=this.rows),(0>t||t>this.rows)&&n("Row index out of range."),e.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns&&n("Invalid row size"),s.call(this,t,0,o(r)),this.rows+=1,this},e.prototype.swapRows=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);var o=this[t];return this[t]=this[r],this[r]=o,this},e.prototype.getColumn=function(t){this.checkColumnIndex(t);for(var r=this.rows,o=new Array(r),i=0;r>i;i++)o[i]=this[i][t];return o},e.prototype.setColumn=function(t,r){this.checkColumnIndex(t),e.isMatrix(r)&&(r=r.to1DArray());var o=this.rows;r.length!==o&&n("Invalid column size");for(var i=0;o>i;i++)this[i][t]=r[i];return this},e.prototype.removeColumn=function(t){this.checkColumnIndex(t),1===this.columns&&n("A matrix cannot have less than one column");for(var r=0,o=this.rows;o>r;r++)this[r].splice(t,1);return this.columns-=1,this},e.prototype.addColumn=function(t,r){"undefined"==typeof r&&(r=t,t=this.columns),(0>t||t>this.columns)&&n("Column index out of range."),e.isMatrix(r)&&(r=r.to1DArray());var o=this.rows;r.length!==o&&n("Invalid column size");for(var i=0;o>i;i++)this[i].splice(t,0,r[i]);return this.columns+=1,this},e.prototype.swapColumns=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);for(var o,i,n=this.rows,e=0;n>e;e++)i=this[e],o=i[t],i[t]=i[r],i[r]=o;return this},e.prototype.checkRowVector=function(t){return e.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.columns&&n("vector size must be the same as the number of columns"),t},e.prototype.checkColumnVector=function(t){return e.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.rows&&n("vector size must be the same as the number of rows"),t},e.prototype.addRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t[n];return this},e.prototype.subRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t[n];return this},e.prototype.mulRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t[n];return this},e.prototype.divRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t[n];return this},e.prototype.addColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t[i];return this},e.prototype.subColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t[i];return this},e.prototype.mulColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t[i];return this},e.prototype.divColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t[i];return this},e.prototype.mulRow=function(t,r){this.checkRowIndex(t);for(var o=0,i=this.columns;i>o;o++)this[t][o]*=r;return this},e.prototype.mulColumn=function(t,r){this.checkColumnIndex(t);for(var o=0,i=this.rows;i>o;o++)this[o][t]*=r},e.prototype.max=function(){for(var t=-1/0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]>t&&(t=this[i][n]);return t},e.prototype.maxIndex=function(){for(var t=-1/0,r={},o=this.rows,i=this.columns,n=0;o>n;n++)for(var e=0;i>e;e++)this[n][e]>t&&(t=this[n][e],r.row=n,r.column=e);return r},e.prototype.min=function(){for(var t=1/0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]<t&&(t=this[i][n]);return t},e.prototype.minIndex=function(){for(var t=1/0,r={},o=this.rows,i=this.columns,n=0;o>n;n++)for(var e=0;i>e;e++)this[n][e]<t&&(t=this[n][e],r.row=n,r.column=e);return r},e.prototype.maxRow=function(t){this.checkRowIndex(t);for(var r=-1/0,o=0,i=this.columns;i>o;o++)this[t][o]>r&&(r=this[t][o]);return r},e.prototype.maxRowIndex=function(t){this.checkRowIndex(t);for(var r=-1/0,o={row:t},i=0,n=this.columns;n>i;i++)this[t][i]>r&&(r=this[t][i],o.column=i);return o},e.prototype.minRow=function(t){this.checkRowIndex(t);for(var r=1/0,o=0,i=this.columns;i>o;o++)this[t][o]<r&&(r=this[t][o]);return r},e.prototype.minRowIndex=function(t){this.checkRowIndex(t);for(var r=1/0,o={row:t,column:0},i=0,n=this.columns;n>i;i++)this[t][i]<r&&(r=this[t][i],o.column=i);return o},e.prototype.maxColumn=function(t){this.checkColumnIndex(t);for(var r=-1/0,o=0,i=this.rows;i>o;o++)this[o][t]>r&&(r=this[o][t]);return r},e.prototype.maxColumnIndex=function(t){this.checkColumnIndex(t);for(var r=-1/0,o={row:0,column:t},i=0,n=this.rows;n>i;i++)this[i][t]>r&&(r=this[i][t],o.row=i);return o},e.prototype.minColumn=function(t){this.checkColumnIndex(t);for(var r=1/0,o=0,i=this.rows;i>o;o++)this[o][t]<r&&(r=this[o][t]);return r},e.prototype.minColumnIndex=function(t){this.checkColumnIndex(t);for(var r=1/0,o={row:0,column:t},i=0,n=this.rows;n>i;i++)this[i][t]<r&&(r=this[i][t],o.row=i);return o},e.prototype.diag=function h(){this.isSquare()||n("Only square matrices have a diagonal.");for(var h=new Array(this.rows),t=0,r=this.rows;r>t;t++)h[t]=this[t][t];return h},e.prototype.sum=function(){for(var t=0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t+=this[i][n];return t},e.prototype.mean=function(){return this.sum()/this.size},e.prototype.prod=function f(){for(var f=1,t=this.rows,r=this.columns,o=0;t>o;o++)for(var i=0;r>i;i++)f*=this[o][i];return f},e.prototype.cumulativeSum=function(){for(var t=0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t+=this[i][n],this[i][n]=t;return this},e.prototype.dot=function u(t){this.size!==t.size&&n("vectors do not have the same size");for(var r=this.to1DArray(),o=t.to1DArray(),u=0,i=r.length,e=0;i>e;e++)u+=r[e]*o[e];return u},e.prototype.mmul=function(t){this.columns!==t.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");var r,o,i,n=this.rows,s=this.columns,a=t.columns,h=new e(n,a),f=new Array(s);for(o=0;a>o;o++){for(i=0;s>i;i++)f[i]=t[i][o];for(r=0;n>r;r++){var u=this[r],c=0;for(i=0;s>i;i++)c+=u[i]*f[i];h[r][o]=c}}return h},e.prototype.sortRows=function(t){for(var r=0,o=this.rows;o>r;r++)this[r].sort(t);return this},e.prototype.sortColumns=function(t){for(var r=0,o=this.columns;o>r;r++)this.setColumn(r,this.getColumn(r).sort(t));return this},e.prototype.transpose=function(){for(var t=new e(this.columns,this.rows),r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t[n][i]=this[i][n];return t},e.prototype.subMatrix=function(t,r,o,i){(t>r||o>i||0>t||t>=this.rows||0>r||r>=this.rows||0>o||o>=this.columns||0>i||i>=this.columns)&&n("Argument out of range");for(var s=new e(r-t+1,i-o+1),a=t;r>=a;a++)for(var h=o;i>=h;h++)s[a-t][h-o]=this[a][h];return s},e.prototype.subMatrixRow=function(t,r,o){"undefined"==typeof r?(r=0,o=this.columns-1):"undefined"==typeof o&&(o=this.columns-1),(r>o||0>r||r>=this.columns||0>o||o>=this.columns)&&n("Argument out of range.");for(var i=t.length,s=this.rows,a=new e(i,o-r+1),h=0;i>h;h++)for(var f=r;o>=f;f++)(t[h]<0||t[h]>=s)&&n("Argument out of range."),a[h][f-r]=this[t[h]][f];return a},e.prototype.subMatrixColumn=function(t,r,o){"undefined"==typeof r?(r=0,o=this.rows-1):"undefined"==typeof o&&(o=this.rows-1),(r>o||0>r||r>=this.rows||0>o||o>=this.rows)&&n("Argument out of range.");for(var i=t.length,s=this.columns,a=new e(o-r+1,i),h=0;i>h;h++)for(var f=r;o>=f;f++)(t[h]<0||t[h]>=s)&&n("Argument out of range."),a[f-r][h]=this[f][t[h]];return a},e.prototype.trace=function c(){this.isSquare()||n("The matrix is not square");for(var c=0,t=0,r=this.rows;r>t;t++)c+=this[t][t];return c},e.prototype.abs=function(){for(var t=this.rows,r=this.columns,o=0;t>o;o++)for(var i=0;r>i;i++)this[o][i]=Math.abs(this[o][i])},e.MatrixError=i,r.exports=e},{}],5:[function(t,r){r.exports=t("./som")},{"./som":8}],6:[function(t,r){function o(t,r,o,n){i.call(this,t,r,o,n),this.hX=t-Math.floor(r/2),this.z=0-this.hX-r}var i=t("./node-square");o.prototype=new i,o.prototype.constructor=o,o.prototype.getDistance=function(t){return Math.max(Math.abs(this.hX-t.hX),Math.abs(this.y-t.y),Math.abs(this.z-t.z))},o.prototype.getDistanceTorus=function(t){var r=Math.abs(this.hX-t.hX),o=Math.abs(this.y-t.y),i=Math.abs(this.z-t.z);return Math.max(Math.min(r,this.gridDim.x-r),Math.min(o,this.gridDim.y-o),Math.min(i,this.gridDim.z-i))},r.exports=o},{"./node-square":7}],7:[function(t,r){function o(t,r,o,i){this.x=t,this.y=r,this.weights=o,this.gridDim=i}o.prototype.adjustWeights=function(t,r,o){for(var i=0,n=this.weights.length;n>i;i++)this.weights[i]+=r*o*(t[i]-this.weights[i])
},o.prototype.getDistance=function(t){return Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))},o.prototype.getDistanceTorus=function(t){var r=Math.abs(this.x-t.x),o=Math.abs(this.y-t.y);return Math.max(Math.min(r,this.gridDim.x-r),Math.min(o,this.gridDim.y-o))},r.exports=o},{}],8:[function(require,module,exports){"use strict";function SOM(t,r,o,i){this.x=t,this.y=r,this.options={};for(var n in defaultOptions)this.options[n]=o.hasOwnProperty(n)?o[n]:defaultOptions[n];if("number"==typeof this.options.fields)this.numWeights=this.options.fields,this.extractor=null;else{var e=Object.keys(this.options.fields);this.numWeights=e.length;var s=getConverters(e,this.options.fields);this.extractor=s.extractor,this.creator=s.creator}if(this.nodeType="rect"===this.options.gridType?NodeSquare:NodeHexagonal,this.distanceMethod=this.options.torus?"getDistanceTorus":"getDistance",this.distance=this.options.distance,i===!0)return void(this.done=!0);if(!(t>0&&r>0))throw new Error("x and y must be positive");this.randomizer=this.options.randomizer,this.iterationCount=0,this.iterations=this.options.iterations,this.startLearningRate=this.learningRate=this.options.learningRate,this.mapRadius=Math.floor(Math.max(t,r)/2),this.algorithmMethod=this.options.method,this._initNodes(),this.done=!1}function getConverters(t,r){for(var o=t.length,i=new Array(o),n=new Array(o),e=0;o>e;e++)i[e]=getNormalizer(r[t[e]]),n[e]=getDenormalizer(r[t[e]]);return{extractor:function(r){for(var n=new Array(o),e=0;o>e;e++)n[e]=i[e](r[t[e]]);return n},creator:function(r){for(var i={},e=0;o>e;e++)i[t[e]]=n[e](r[e]);return i}}}function getNormalizer(t){return function(r){return(r-t[0])/(t[1]-t[0])}}function getDenormalizer(t){return function(r){return t[0]+r*(t[1]-t[0])}}function squareEuclidean(t,r){for(var o=0,i=0,n=t.length;n>i;i++)o+=(t[i]-r[i])*(t[i]-r[i]);return o}function getRandomValue(t,r){return t[Math.floor(r()*t.length)]}var NodeSquare=require("./node-square"),NodeHexagonal=require("./node-hexagonal"),defaultOptions={fields:3,randomizer:Math.random,distance:squareEuclidean,iterations:10,learningRate:.1,gridType:"rect",torus:!0,method:"random"};SOM.load=function loadModel(model,distance){if("SOM"===model.name){var x=model.data.length,y=model.data[0].length;distance?model.options.distance=distance:model.options.distance&&(model.options.distance=eval("("+model.options.distance+")"));var som=new SOM(x,y,model.options,!0);som.nodes=new Array(x);for(var gridDim=som._getGridDim(),i=0;x>i;i++){som.nodes[i]=new Array(y);for(var j=0;y>j;j++)som.nodes[i][j]=new som.nodeType(i,j,model.data[i][j],gridDim)}return som}throw new Error("expecting a SOM model")},SOM.prototype.export=function(t){if(!this.done)throw new Error("model is not ready yet");var r={name:"SOM"};r.options={fields:this.options.fields,gridType:this.options.gridType,torus:this.options.torus},r.data=new Array(this.x);for(var o=0;o<this.x;o++){r.data[o]=new Array(this.y);for(var i=0;i<this.y;i++)r.data[o][i]=this.nodes[o][i].weights}return t&&(r.options.distance=this.distance.toString()),r},SOM.prototype._getGridDim=function(){if(this.nodeType===NodeSquare)return{x:this.x,y:this.y};var t=this.x-Math.floor(this.y/2);return{x:t,y:this.y,z:-(0-t-this.y)}},SOM.prototype._initNodes=function(){var t,r,o;this.nodes=new Array(this.x);var i=this._getGridDim();for(t=0;t<this.x;t++)for(this.nodes[t]=new Array(this.y),r=0;r<this.y;r++){var n=new Array(this.numWeights);for(o=0;o<this.numWeights;o++)n[o]=this.randomizer();this.nodes[t][r]=new this.nodeType(t,r,n,i)}},SOM.prototype.setTraining=function(t){if(this.trainingSet)throw new Error("training set has already been set");var r,o=t,i=t.length;if(this.extractor)for(o=new Array(t),r=0;i>r;r++)o[r]=this.extractor(t[r]);this.numIterations=this.iterations*i,this.timeConstant="random"===this.algorithmMethod?this.numIterations/Math.log(this.mapRadius):i/Math.log(this.mapRadius),this.trainingSet=o},SOM.prototype.trainOne=function(){if(this.done)return!1;if(this.numIterations-->0){var t,r,o;return"random"===this.algorithmMethod?(t=this.mapRadius*Math.exp(-this.iterationCount/this.timeConstant),r=getRandomValue(this.trainingSet,this.randomizer),this._adjust(r,t),this.learningRate=this.startLearningRate*Math.exp(-this.iterationCount/this.numIterations)):(o=-Math.floor(this.iterationCount/this.trainingSet.length),t=this.mapRadius*Math.exp(o/this.timeConstant),r=this.trainingSet[this.iterationCount%this.trainingSet.length],this._adjust(r,t),(this.iterationCount+1)%this.trainingSet.length===0&&(this.learningRate=this.startLearningRate*Math.exp(o/Math.floor(this.numIterations/this.trainingSet.length)))),this.iterationCount++,!0}return this.done=!0,!1},SOM.prototype._adjust=function(t,r){var o,i,n,e,s=this._findBestMatchingUnit(t),a=Math.floor(r),h=s.x-a,f=s.x+a,u=s.y-a,c=s.y+a;for(o=h;f>=o;o++){var m=o;for(0>o?m+=this.x:o>=this.x&&(m-=this.x),i=u;c>=i;i++){var l=i;0>i?l+=this.y:i>=this.y&&(l-=this.y),n=s[this.distanceMethod](this.nodes[m][l]),r>n&&(e=Math.exp(-n/(2*r)),this.nodes[m][l].adjustWeights(t,this.learningRate,e))}}},SOM.prototype.train=function(t){if(!this.done)for(this.setTraining(t);this.trainOne(););},SOM.prototype.getConvertedNodes=function(){for(var t=new Array(this.x),r=0;r<this.x;r++){t[r]=new Array(this.y);for(var o=0;o<this.y;o++){var i=this.nodes[r][o];t[r][o]=this.creator?this.creator(i.weights):i.weights}}return t},SOM.prototype._findBestMatchingUnit=function(t){for(var r,o,i=1/0,n=0;n<this.x;n++)for(var e=0;e<this.y;e++)o=this.distance(this.nodes[n][e].weights,t),i>o&&(i=o,r=this.nodes[n][e]);return r},SOM.prototype.predict=function(t){if(t instanceof Array){var r=this;return t.map(function(t){return r._predict(t)})}return this._predict(t)},SOM.prototype._predict=function(t){t instanceof Array||(t=this.extractor(t));var r=this._findBestMatchingUnit(t);return[r.x,r.y]},SOM.prototype.getQuantizationError=function(){for(var t,r=this.trainingSet,o=r.length,i=0,n=0;o>n;n++)t=this._findBestMatchingUnit(r[n]),i+=Math.sqrt(squareEuclidean(r[n],t.weights));return i/o},module.exports=SOM},{"./node-hexagonal":6,"./node-square":7}]},{},[1])(1)});